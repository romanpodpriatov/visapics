<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - VisaPicture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        #payment-element-container {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background-color: white;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            min-height: 100px;
            padding: 1rem;
        }
        .payment-form {
            max-width: 500px;
            margin: 0 auto;
        }
        .button-spinner svg {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
        <div class="payment-form">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">üí≥ Secure Payment</h1>
                <p class="text-gray-600">Complete your purchase to download your visa photo</p>
            </div>
            
            <!-- Order Summary -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Order Summary</h2>
                
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Product:</span>
                        <span class="font-medium" id="product-name">Visa Photo Download</span>
                    </div>
                    <div class="border-t pt-3 flex justify-between text-lg font-bold">
                        <span>Total:</span>
                        <span id="total-amount">$2.99</span>
                    </div>
                </div>
                
                <!-- What's included -->
                <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-md">
                    <h3 class="text-sm font-medium text-green-800 mb-2">‚úÖ What's included:</h3>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>‚Ä¢ High-quality processed visa photo (without watermark)</li>
                        <li id="printable-included" class="hidden">‚Ä¢ Printable 4x6" layout for professional printing</li>
                        <li>‚Ä¢ Email receipt and download links</li>
                        <li>‚Ä¢ 30 days download access</li>
                        <li>‚Ä¢ Up to 5 downloads per order</li>
                    </ul>
                </div>
            </div>
            
            <!-- Payment Form -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <form id="payment-form">
                    <div class="mb-6">
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                            Email Address *
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            placeholder="your@email.com"
                        >
                        <p class="mt-1 text-xs text-gray-500">We will send a copy of the result photo and a receipt to this email address.</p>
                    </div>
                    
                    <div class="mb-6">
                        <label for="payment-element-container" class="block text-sm font-medium text-gray-700 mb-2">
                            Payment Information *
                        </label>
                        <div id="payment-element-container">
                            <div id="payment-element-placeholder" class="text-gray-500 text-center py-4">
                                <i data-lucide="loader-2" class="w-6 h-6 mx-auto mb-2 text-gray-400 animate-spin"></i>
                                <p class="text-sm">Loading payment form...</p>
                            </div>
                        </div>
                        <div id="payment-message" role="alert" class="text-red-600 text-sm mt-1"></div>
                    </div>
                    
                    <!-- Security Notice -->
                    <div class="mb-6 p-3 bg-blue-50 border border-blue-200 rounded-md">
                        <div class="flex items-start">
                            <i data-lucide="shield-check" class="w-5 h-5 text-blue-600 mr-2 mt-0.5"></i>
                            <div class="text-sm text-blue-700">
                                <p class="font-medium">Secure Payment</p>
                                <p>Your payment is processed securely by Stripe. We never store your card information.</p>
                            </div>
                        </div>
                    </div>
                    
                    <button 
                        type="submit" 
                        id="submit-button"
                        disabled
                        class="w-full bg-blue-600 text-white py-3 px-4 rounded-md font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150"
                    >
                        <span id="button-text">Complete Payment</span>
                        <span id="spinner" class="hidden button-spinner">
                            <svg class="h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </span>
                    </button>
                </form>
                
                <!-- Success Message -->
                <div id="payment-success" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-md">
                    <div class="flex">
                        <i data-lucide="check-circle" class="w-5 h-5 text-green-600 mr-2 mt-0.5"></i>
                        <div>
                            <h3 class="text-sm font-medium text-green-800">Payment Successful!</h3>
                            <div class="mt-2 text-sm text-green-700">
                                <p>Your order <span id="order-number" class="font-medium"></span> has been processed.</p>
                                <p>Check your email for download links and receipt.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Error Message -->
                <div id="payment-error" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-md">
                    <div class="flex">
                        <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 mr-2 mt-0.5"></i>
                        <div>
                            <h3 class="text-sm font-medium text-red-800">Payment Failed</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <p id="error-message">An error occurred processing your payment.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="text-center mt-6 text-sm text-gray-500">
                <p>Need help? Contact support with any questions.</p>
                <p class="mt-2">
                    <a href="/" class="text-blue-600 hover:text-blue-500">‚Üê Back to Photo Processing</a>
                </p>
            </div>
        </div>
    </div>
    
<script>
    // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
    let stripe;
    let elements;
    let paymentElement;
    let paymentData = {}; // –î–∞–Ω–Ω—ã–µ –æ –∑–∞–∫–∞–∑–µ (email, —Ñ–∞–π–ª—ã, —Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ç–∞, —Ü–µ–Ω—ã)

    let isEmailFieldValid = false;
    let isStripeElementComplete = false;

    // --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã (–ø–æ–ª—É—á–∏–º –∏—Ö –æ–¥–∏–Ω —Ä–∞–∑) ---
    let emailField, submitButton, buttonTextEl, spinnerEl;
    let productNameEl, totalAmountEl, printableIncludedEl;
    let paymentElementContainerEl, paymentMessageEl;
    let paymentSuccessEl, orderNumberEl, paymentErrorEl, errorMessageEl;
    let paymentElementPlaceholderEl;

    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫
        initializeDOMElements();
        setupEventListeners();
        initializePaymentData(); // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞—Ç–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Stripe
        updateSubmitButtonState(); // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    });

    function initializeDOMElements() {
        emailField = document.getElementById('email');
        submitButton = document.getElementById('submit-button');
        buttonTextEl = document.getElementById('button-text');
        spinnerEl = document.getElementById('spinner');

        productNameEl = document.getElementById('product-name');
        totalAmountEl = document.getElementById('total-amount');
        printableIncludedEl = document.getElementById('printable-included');

        paymentElementContainerEl = document.getElementById('payment-element-container');
        paymentElementPlaceholderEl = document.getElementById('payment-element-placeholder');
        paymentMessageEl = document.getElementById('payment-message');

        paymentSuccessEl = document.getElementById('payment-success');
        orderNumberEl = document.getElementById('order-number');
        paymentErrorEl = document.getElementById('payment-error');
        errorMessageEl = document.getElementById('error-message');
    }

    function setupEventListeners() {
        emailField.addEventListener('input', () => {
            isEmailFieldValid = validateEmail(emailField.value);
            updateSubmitButtonState();
        });
        document.getElementById('payment-form').addEventListener('submit', handlePaymentSubmit);
    }

    async function initializePaymentData() {
        const urlParams = new URLSearchParams(window.location.search);
        const storedData = localStorage.getItem('paymentData');
        const urlEmail = urlParams.get('email');
        const urlFilename = urlParams.get('filename');
        const urlPrintableFilename = urlParams.get('printable_filename');

        let rawData = {};

        if (storedData) {
            rawData = JSON.parse(storedData);
            if (urlEmail) rawData.email = urlEmail; // Email –∏–∑ URL –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
        } else if (urlEmail && urlFilename) {
            rawData.email = urlEmail;
            rawData.processed_filename = urlFilename;
            rawData.printable_filename = urlPrintableFilename;
        } else {
            // Test/Fallback: –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ü–µ–Ω—ã –¥–ª—è "single_photo"
            // –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
            console.warn("No payment data found in URL or localStorage. Using test data.");
            rawData.email = 'test@example.com'; // –¢–µ—Å—Ç–æ–≤—ã–π email
            rawData.processed_filename = 'test_file.jpg'; // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è PI
            rawData.product_type = 'single_photo'; // –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–µ–Ω—É
        }
        
        paymentData.email = rawData.email;
        paymentData.processed_filename = rawData.processed_filename;
        paymentData.printable_filename = rawData.printable_filename;
        paymentData.product_type = rawData.printable_filename ? 'photo_with_printable' : (rawData.product_type || 'single_photo');
        paymentData.photo_info = rawData.photo_info;

        try {
            const pricingResponse = await fetch('/api/pricing');
            if (!pricingResponse.ok) throw new Error('Failed to load pricing information.');
            const allPricing = await pricingResponse.json();
            paymentData.pricing = allPricing[paymentData.product_type];

            if (!paymentData.pricing) {
                 throw new Error(`Pricing not available for product type: ${paymentData.product_type}`);
            }
            if (!paymentData.processed_filename && !rawData.product_type) { // –ï—Å–ª–∏ –¥–∞–∂–µ –≤ fallback –Ω–µ –±—ã–ª–æ product_type –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã
                 throw new Error('Essential product information is missing.');
            }

            updateOrderSummaryUI(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—ã –≤ Order Summary

            if (paymentData.email) {
                emailField.value = paymentData.email;
                isEmailFieldValid = validateEmail(paymentData.email); // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π email
            }
            
            // –ï—Å–ª–∏ –ø–æ–ª–µ email –ø—É—Å—Ç–æ–µ, –Ω–æ —É –Ω–∞—Å –µ—Å—Ç—å email –≤ –¥–∞–Ω–Ω—ã—Ö, –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ
            if (!emailField.value && paymentData.email) {
                emailField.value = paymentData.email;
                isEmailFieldValid = validateEmail(paymentData.email);
            }
            
            await initializeStripe(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Stripe –ü–û–°–õ–ï –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

        } catch (error) {
            console.error('Data initialization or pricing error:', error);
            showErrorToUser(`Initialization failed: ${error.message}. Please try refreshing.`);
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
            isEmailFieldValid = false;
            isStripeElementComplete = false;
            if (paymentElementPlaceholderEl) {
                paymentElementPlaceholderEl.innerHTML = `<i data-lucide="alert-triangle" class="w-6 h-6 mx-auto mb-2 text-red-500"></i><p class="text-sm text-red-500">Could not load payment form.</p>`;
                lucide.createIcons();
            }
        }
        updateSubmitButtonState(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    }

    function updateOrderSummaryUI() {
        if (!paymentData.pricing) {
            productNameEl.textContent = "N/A";
            totalAmountEl.textContent = "N/A";
            return;
        }
        productNameEl.textContent = paymentData.pricing.description;
        totalAmountEl.textContent = `$${(paymentData.pricing.amount_cents / 100).toFixed(2)}`;
        if (paymentData.printable_filename) {
            printableIncludedEl.classList.remove('hidden');
        }
    }

    function validateEmail(email) {
        const trimmedEmail = email.trim();
        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º
        return trimmedEmail && trimmedEmail.includes('@') && trimmedEmail.includes('.') && trimmedEmail.length > 5;
    }

    function updateSubmitButtonState() {
        submitButton.disabled = !(isEmailFieldValid && isStripeElementComplete);
    }

    async function initializeStripe() {
        try {
            // Email –¥–ª—è Payment Intent –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –Ω–∞ –±—ç–∫–µ–Ω–¥–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PI,
            // –Ω–æ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ confirmPayment.
            // –ï—Å–ª–∏ email —É–∂–µ –µ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–µ–Ω, –ø–µ—Ä–µ–¥–∞–µ–º –µ–≥–æ.
            const currentEmail = emailField.value.trim();

            if (!paymentData.processed_filename) {
                throw new Error('Essential product data (filename) is missing for payment intent.');
            }

            // –î–ª—è fallback –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ paymentData, –¥–ª—è –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã - –∏–∑ –ø–æ–ª—è
            const emailToSend = validateEmail(currentEmail) ? currentEmail : paymentData.email;
            
            console.log('Creating payment intent with:', {
                email: emailToSend,
                processed_filename: paymentData.processed_filename,
                product_type: paymentData.product_type
            });

            const response = await fetch('/api/create-payment-intent', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: emailToSend, // –ò—Å–ø–æ–ª—å–∑—É–µ–º email –∏–∑ –ø–æ–ª—è –∏–ª–∏ fallback
                    processed_filename: paymentData.processed_filename,
                    printable_filename: paymentData.printable_filename,
                    product_type: paymentData.product_type,
                    photo_info: paymentData.photo_info
                })
            });
            const data = await response.json();
            if (!response.ok) {
                console.error('Payment intent creation failed:', data);
                throw new Error(data.error || `Server error: ${response.status}`);
            }
            
            console.log('Payment intent created successfully:', data.order_number);

            stripe = Stripe(data.publishable_key);
            const appearance = { 
                theme: 'stripe',
                variables: {
                    colorPrimary: '#3b82f6',
                    colorBackground: '#ffffff',
                    colorText: '#374151',
                    colorDanger: '#ef4444',
                    fontFamily: 'Inter, system-ui, sans-serif',
                    spacingUnit: '4px',
                    borderRadius: '6px'
                }
            };
            elements = stripe.elements({ clientSecret: data.client_secret, appearance });
            paymentElement = elements.create('payment', { layout: { type: 'tabs', defaultCollapsed: false } });
            
            // –û—á–∏—â–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –ø–µ—Ä–µ–¥ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –µ—Å—Ç—å
            if (paymentElementPlaceholderEl) paymentElementPlaceholderEl.innerHTML = '';
            paymentElement.mount('#payment-element-container'); // –ú–æ–Ω—Ç–∏—Ä—É–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

            paymentElement.on('change', (event) => {
                isStripeElementComplete = event.complete;
                paymentMessageEl.textContent = event.error ? event.error.message : '';
                updateSubmitButtonState();
            });

            paymentData.clientSecret = data.client_secret;
            paymentData.orderNumber = data.order_number;

        } catch (error) {
            console.error('Stripe initialization error:', error);
            showErrorToUser(`Payment form error: ${error.message}`);
            isStripeElementComplete = false; // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
            updateSubmitButtonState();
            if (paymentElementPlaceholderEl) { // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –Ω–µ –±—ã–ª –∑–∞–º–µ–Ω–µ–Ω Stripe
                paymentElementPlaceholderEl.innerHTML = `<i data-lucide="alert-triangle" class="w-6 h-6 mx-auto mb-2 text-red-500"></i><p class="text-sm text-red-500">Could not load payment form.</p>`;
                lucide.createIcons();
            }
        }
    }

    async function handlePaymentSubmit(event) {
        event.preventDefault();
        const currentEmail = emailField.value.trim();

        if (!isEmailFieldValid || !validateEmail(currentEmail)) { // –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            showErrorToUser('Please enter a valid email address.');
            emailField.focus();
            return;
        }
        if (!isStripeElementComplete) {
            showErrorToUser('Please complete the payment information.');
            // –ü–æ–ø—ã—Ç–∫–∞ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–µ Stripe (–Ω–µ –≤—Å–µ–≥–¥–∞ –Ω–∞–¥–µ–∂–Ω–æ)
            if (paymentElement) paymentElement.focus();
            return;
        }
        if (!stripe || !elements) {
            showErrorToUser('Payment system is not ready. Please refresh.');
            return;
        }

        setLoading(true);
        try {
            const { error } = await stripe.confirmPayment({
                elements,
                confirmParams: {
                    return_url: `${window.location.origin}/payment-success?order=${paymentData.orderNumber}`,
                    receipt_email: currentEmail,
                },
                redirect: 'if_required'
            });

            if (error) {
                showErrorToUser(error.message);
            } else {
                // –ï—Å–ª–∏ redirect: 'if_required' –∏ –Ω–µ—Ç –æ—à–∏–±–∫–∏, –Ω–æ –Ω–µ—Ç –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞,
                // —ç—Ç–æ –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–µ–Ω (–∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è,
                // –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —á–µ—Ä–µ–∑ webhook –∏/–∏–ª–∏ –Ω–∞ return_url).
                // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∑–¥–µ—Å—å —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º.
                showSuccessScreen(paymentData.orderNumber);
                localStorage.removeItem('paymentData');
            }
        } catch (e) {
            console.error('Payment submission error:', e);
            showErrorToUser('An unexpected error occurred during payment.');
        } finally {
            setLoading(false);
            updateSubmitButtonState(); // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        }
    }

    function setLoading(loading) {
        submitButton.disabled = loading;
        if (loading) {
            buttonTextEl.classList.add('hidden');
            spinnerEl.classList.remove('hidden');
        } else {
            buttonTextEl.classList.remove('hidden');
            spinnerEl.classList.add('hidden');
        }
    }

    function showSuccessScreen(orderNum) {
        document.getElementById('payment-form').classList.add('hidden');
        paymentErrorEl.classList.add('hidden');
        if (orderNumberEl) orderNumberEl.textContent = orderNum;
        paymentSuccessEl.classList.remove('hidden');
    }

    function showErrorToUser(message) { // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏, —á—Ç–æ —ç—Ç–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        paymentSuccessEl.classList.add('hidden');
        if (errorMessageEl) errorMessageEl.textContent = message;
        paymentErrorEl.classList.remove('hidden');
    }

</script>
</body>
</html>